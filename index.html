<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Total De Ações</title>

    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 32px;
            color: white;
            font-weight: bold;
            text-shadow: -2px 2px 0px black;
            user-select: none;
        }

        body {
            width: 100vw;
            height: 100vh;
            border: 10px solid white;
            background-color: #00c900;
        }

        [type="checkbox"] {
            margin: 0 0 0 20px;
            width: 20px;
            height: 20px;
        }

        h1 {
            position: absolute;
            top: 10%;
            left: 60%;
            font-size: 60px;
            background-color: white;
            color: black;
            width: 300px;
            height: 95px;
            border-radius: 10px;
            text-align: center;
            text-decoration: underline;
            text-shadow: none;
        }

        h2 {
            position: absolute;
            top: 25%;
            left: 64%;
            font-size: 48px;
            background-color: red;
            border: 4px solid white;
            color: white;
            width: 200px;
            height: 80px;
            border-radius: 10px;
            text-align: center;
        }

        h3 {
            position: absolute;
            top: 37.5%;
            left: 64%;
            font-size: 48px;
            background-color: white;
            color: #0080ff;
            border: 4px solid #0080ff;
            width: 200px;
            height: 80px;
            border-radius: 10px;
            text-align: center;
        }

        h2:hover,
        h3:hover {
            transform: scale(1.05);
        }

        .pre {
            font-size: 32px;
            color: black;
            text-shadow: none;
        }

        .desactive {
            display: none;
        }

        .active {
            display: inline;
            color: greenyellow;
        }
    </style>

</head>

<body>
    <h1 id="total"><span class="pre">R$ </span>00.00</h1>

    <h2 id="reset">Reset</h2>
    <h3 id="all">All</h3>

    <input type="checkbox" name="checkbox1">
    <label for="checkbox1">VSLH11: <span class="desactive"></span></label>
    <br>

    <input type="checkbox" name="checkbox2">
    <label for="checkbox2">HFOF11: <span class="desactive"></span></label>
    <br>

    <input type="checkbox" name="checkbox2">
    <label for="checkbox2">GARE11: <span class="desactive"></span></label>
    <br>

    <input type="checkbox" name="checkbox3">
    <label for="checkbox3">KISU11: <span class="desactive"></span></label>
    <br>

    <input type="checkbox" name="checkbox4">
    <label for="checkbox4">CPTS11: <span class="desactive"></span></label>
    <br>

    <input type="checkbox" name="checkbox5">
    <label for="checkbox5">XPCA11: <span class="desactive"></span></label>
    <br>

    <input type="checkbox" name="checkbox6">
    <label for="checkbox6">DPRO11: <span class="desactive"></span></label>
    <br>

    <input type="checkbox" name="checkbox7">
    <label for="checkbox7">GAME11: <span class="desactive"></span></label>
    <br>

    <input type="checkbox" name="checkbox8">
    <label for="checkbox8">MXRF11: <span class="desactive"></span></label>
    <br>

    <input type="checkbox" name="checkbox9">
    <label for="checkbox9">XPSF11: <span class="desactive"></span></label>
    <br>

    <input type="checkbox" name="checkbox10">
    <label for="checkbox10">BEES3F: <span class="desactive"></span></label>
    <br>

    <input type="checkbox" name="checkbox11">
    <label for="checkbox11">VINO11: <span class="desactive"></span></label>
    <br>

    <input type="checkbox" name="checkbox11">
    <label for="checkbox11">AJFI11: <span class="desactive"></span></label>
    <br>

    <script>

        let saveObj = JSON.parse(localStorage.getItem('FIIs'))

        let checkbox = document.querySelectorAll('[type=checkbox]')
        let arrayCheckbox = [...checkbox]

        let spans = document.querySelectorAll('span')
        let arraySpans = [...spans]

        let labels = document.querySelectorAll('label')
        let labels2 = [...labels]
        let labels3 = []

        labels2.forEach(tag => {
            labels3.push(tag.innerText)
        })

        if (!localStorage.getItem("FIIs")) {
            let newObj = {
                VSLH11:0,
                HFOF11:0,
                GARE11:0,
                KISU11:0,
                CPTS11:0,
                XPCA11:0,
                DPRO11:0,
                GAME11:0,
                MXRF11:0,
                XPSF11:0,
                BEES3F:0,
                VINO11:0,
                AJFI11:0
            }

            localStorage.setItem("FIIs", JSON.stringify(newObj))
        } else {
            Object.keys(saveObj).forEach((chave, idx) => {
                labels3.forEach(tag => {
                    if (chave == tag.split(":")[0]) {
                        arraySpans[labels3.indexOf(`${chave}:`) + 1].innerText = saveObj[chave]
                    }
                })
            });
        }

        let total = 0
        let totalTag = document.querySelector('h1')

        function yeah() {
            total = 0

            arrayCheckbox.forEach((check, index) => {
                check.addEventListener('click', () => {
                    total = 0

                    if (check.checked == true) {
                        arraySpans[index + 1].classList.remove('desactive')
                        arraySpans[index + 1].classList.add('active')
                    } else {
                        arraySpans[index + 1].classList.remove('active')
                        arraySpans[index + 1].classList.add('desactive')
                    }

                    count()
                })

            })
        }

        function count() {
            total = 0

            arraySpans.forEach(span => {
                if (span.className == 'active') {
                    total += parseFloat(span.innerHTML)
                }

                let float = total.toFixed(2).toString().split('.')[1]
                let int = total.toString().split('.')[0]
                let totalNew = `${int.padStart(2, '0')}.${float}`

                totalTag.innerHTML = `<span class="pre">R$ </span>${totalNew}`
            })
        }

        function save() {
            arrayCheckbox.forEach(check => {
                check.checked = false
            })

            arraySpans.forEach(span => {
                span.classList.remove('active')
                span.classList.add('desactive')
            })

            total = 0
            totalTag.innerHTML = '<span class="pre">R$ </span>00.00'

            if (!localStorage.getItem("FIIs")) {

            } else {
                let labels = document.querySelectorAll('label')
                let labels2 = [...labels]
                let labels3 = []

                labels2.forEach(tag => {
                    labels3.push(tag.innerText)
                })

                let newLabels = labels3.map(word => word.replace(":", ''))

                let spans = document.querySelectorAll('span')
                let spans2 = [...spans]
                let spans3 = []

                spans2.forEach((tag, index) => {
                    if (tag.innerText != "R$ ") {
                        spans3.push(tag.innerText)
                    }
                })

                let FIIs = newLabels.map((word, i) => `${word}: ${spans3[i]}`);

                const obj = FIIs.reduce((acc, item) => {
                    const [chave, valor] = item.split(':').map(s => s.trim());
                    acc[chave] = valor;
                    return acc;
                }, {}); //Objeto Inical Vazio - Acc >> Acumulador

                localStorage.setItem("FIIs", JSON.stringify(obj))
            }
        }

        document.querySelector('#reset').addEventListener("click", () => {
            arrayCheckbox.forEach(check => {
                check.checked = false
            })

            arraySpans.forEach(span => {
                span.classList.remove('active')
                span.classList.add('desactive')
            })

            total = 0
            totalTag.innerHTML = '<span class="pre">R$ </span>00.00'
        })

        document.querySelector('#all').addEventListener("click", () => {

            arrayCheckbox.forEach(check => {
                check.checked = true
            })

            arraySpans.forEach(span => {
                span.classList.remove('desactive')
                span.classList.add('active')
            })

            count()

        })

        arraySpans.forEach(span => {
            span.addEventListener('click', () => {
                let newValor = prompt("Novo Valor:")
                span.innerHTML = newValor

                save()
                count()
            })
        })

        yeah()

    </script>
</body>

</html>